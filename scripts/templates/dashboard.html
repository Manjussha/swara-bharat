<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéôÔ∏è Swara-Bharat Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
        }

        .status-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin-top: 15px;
            font-size: 1.1em;
        }

        .status-running {
            background: #4caf50;
            color: white;
        }

        .status-idle {
            background: #ff9800;
            color: white;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        .stat-value {
            color: #333;
            font-weight: bold;
            font-size: 1.1em;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .category-list {
            margin-top: 15px;
        }

        .category-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .category-name {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
            text-transform: capitalize;
        }

        .logs-container {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .log-line {
            padding: 3px 0;
            word-wrap: break-word;
        }

        .recent-downloads {
            max-height: 400px;
            overflow-y: auto;
        }

        .download-item {
            background: #f8f9fa;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 3px solid #4caf50;
        }

        .download-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .download-meta {
            font-size: 0.85em;
            color: #666;
        }

        .update-time {
            text-align: center;
            color: white;
            margin-top: 20px;
            font-size: 0.9em;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 1.5s infinite;
        }

        .big-number {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéôÔ∏è Swara-Bharat Dashboard</h1>
            <p class="subtitle">YouTube Audio Automation Monitor</p>
            <div id="status-badge" class="status-badge loading">Loading...</div>
        </header>

        <div class="grid">
            <!-- Download Stats -->
            <div class="card">
                <h2>üì• Download Statistics</h2>
                <div class="big-number" id="total-files">0</div>
                <div style="text-align: center; color: #666; margin-bottom: 20px;">Total Files Downloaded</div>
                <div class="stat-item">
                    <span class="stat-label">Total Size</span>
                    <span class="stat-value" id="total-size">0 MB</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Categories</span>
                    <span class="stat-value" id="total-categories">0</span>
                </div>
            </div>

            <!-- System Stats -->
            <div class="card">
                <h2>üíª System Status</h2>
                <div class="stat-item">
                    <span class="stat-label">CPU Usage</span>
                    <span class="stat-value" id="cpu-usage">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="cpu-bar" style="width: 0%"></div>
                </div>

                <div class="stat-item">
                    <span class="stat-label">Memory Usage</span>
                    <span class="stat-value" id="memory-usage">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="memory-bar" style="width: 0%"></div>
                </div>

                <div class="stat-item">
                    <span class="stat-label">Disk Usage</span>
                    <span class="stat-value" id="disk-usage">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="disk-bar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Configuration -->
            <div class="card">
                <h2>‚öôÔ∏è Configuration</h2>
                <div class="stat-item">
                    <span class="stat-label">Language</span>
                    <span class="stat-value" id="config-language">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Downloads/Category</span>
                    <span class="stat-value" id="config-downloads">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Audio Quality</span>
                    <span class="stat-value" id="config-quality">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Schedule</span>
                    <span class="stat-value" id="config-schedule">-</span>
                </div>
            </div>
        </div>

        <!-- Categories Breakdown -->
        <div class="card">
            <h2>üìä Downloads by Category</h2>
            <div class="category-list" id="categories-list">
                <p style="text-align: center; color: #666;">Loading categories...</p>
            </div>
        </div>

        <!-- Recent Downloads -->
        <div class="card">
            <h2>üéµ Recent Downloads</h2>
            <div class="recent-downloads" id="recent-downloads">
                <p style="text-align: center; color: #666;">Loading recent downloads...</p>
            </div>
        </div>

        <!-- Live Logs -->
        <div class="card">
            <h2>üìù Live Logs</h2>
            <div class="logs-container" id="logs-container">
                <div class="log-line">Loading logs...</div>
            </div>
        </div>

        <div class="update-time">
            Last updated: <span id="last-update">Never</span> |
            Auto-refresh: <span id="refresh-countdown">5</span>s
        </div>
    </div>

    <script>
        let refreshInterval = 5; // seconds
        let countdown = refreshInterval;

        function updateStats() {
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    // Status
                    const statusBadge = document.getElementById('status-badge');
                    statusBadge.textContent = data.process.status;
                    statusBadge.className = 'status-badge ' +
                        (data.process.running ? 'status-running' : 'status-idle');

                    // Download stats
                    document.getElementById('total-files').textContent =
                        data.downloads.total_files.toLocaleString();
                    document.getElementById('total-size').textContent =
                        data.downloads.total_size_mb.toFixed(2) + ' MB';
                    document.getElementById('total-categories').textContent =
                        Object.keys(data.downloads.by_category).length;

                    // System stats
                    document.getElementById('cpu-usage').textContent =
                        data.system.cpu_percent.toFixed(1) + '%';
                    document.getElementById('cpu-bar').style.width =
                        data.system.cpu_percent + '%';
                    document.getElementById('cpu-bar').textContent =
                        data.system.cpu_percent.toFixed(0) + '%';

                    document.getElementById('memory-usage').textContent =
                        data.system.memory_percent.toFixed(1) + '%';
                    document.getElementById('memory-bar').style.width =
                        data.system.memory_percent + '%';
                    document.getElementById('memory-bar').textContent =
                        data.system.memory_percent.toFixed(0) + '%';

                    document.getElementById('disk-usage').textContent =
                        data.system.disk_percent.toFixed(1) + '%';
                    document.getElementById('disk-bar').style.width =
                        data.system.disk_percent + '%';
                    document.getElementById('disk-bar').textContent =
                        data.system.disk_percent.toFixed(0) + '%';

                    // Configuration
                    if (data.config) {
                        document.getElementById('config-language').textContent =
                            (data.config.language || '-').toUpperCase();
                        document.getElementById('config-downloads').textContent =
                            data.config.downloads_per_category || '-';
                        document.getElementById('config-quality').textContent =
                            (data.config.audio_quality || '-') + ' kbps MP3';
                        document.getElementById('config-schedule').textContent =
                            data.config.automation?.time || '-';
                    }

                    // Categories
                    const categoriesList = document.getElementById('categories-list');
                    if (Object.keys(data.downloads.by_category).length > 0) {
                        categoriesList.innerHTML = Object.entries(data.downloads.by_category)
                            .map(([name, info]) => `
                                <div class="category-item">
                                    <div class="category-name">${name}</div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span>Files: <strong>${info.count}</strong></span>
                                        <span>Size: <strong>${info.size_mb.toFixed(2)} MB</strong></span>
                                    </div>
                                </div>
                            `).join('');
                    }

                    // Recent downloads
                    const recentDownloads = document.getElementById('recent-downloads');
                    if (data.downloads.recent_downloads.length > 0) {
                        recentDownloads.innerHTML = data.downloads.recent_downloads
                            .map(file => `
                                <div class="download-item">
                                    <div class="download-name">${file.name}</div>
                                    <div class="download-meta">
                                        üìÅ ${file.category} |
                                        üíæ ${file.size_mb} MB |
                                        üïê ${file.time}
                                    </div>
                                </div>
                            `).join('');
                    }

                    // Update timestamp
                    document.getElementById('last-update').textContent =
                        new Date().toLocaleTimeString();
                })
                .catch(error => console.error('Error fetching stats:', error));
        }

        function updateLogs() {
            fetch('/api/logs')
                .then(response => response.json())
                .then(data => {
                    const logsContainer = document.getElementById('logs-container');
                    if (data.logs && data.logs.length > 0) {
                        logsContainer.innerHTML = data.logs
                            .map(line => `<div class="log-line">${line.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>`)
                            .join('');
                        logsContainer.scrollTop = logsContainer.scrollHeight;
                    }
                })
                .catch(error => console.error('Error fetching logs:', error));
        }

        function startCountdown() {
            countdown = refreshInterval;
            const countdownEl = document.getElementById('refresh-countdown');

            setInterval(() => {
                countdown--;
                if (countdown <= 0) {
                    countdown = refreshInterval;
                    updateStats();
                    updateLogs();
                }
                countdownEl.textContent = countdown;
            }, 1000);
        }

        // Initial load
        updateStats();
        updateLogs();
        startCountdown();

        // Regular updates
        setInterval(updateStats, refreshInterval * 1000);
        setInterval(updateLogs, refreshInterval * 1000);
    </script>
</body>
</html>
